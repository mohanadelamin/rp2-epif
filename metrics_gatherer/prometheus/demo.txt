Walkthroug: https://github.com/kubernetes-sigs/prometheus-adapter/blob/master/docs/walkthrough.md

# 1. Install prometheus adapter:
$ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
$ helm repo update
$ helm install my-release prometheus-community/prometheus-adapter
Test that it works:
kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1
# 2: Install Prometheus operator:
kubectl apply -f prometheus-operator/bundle.yaml 
# 3: Deploy the app
$ kubectl create -f sample-app.deploy.yaml
$ kubectl create -f sample-app.service.yaml
# 4. test with curl
 curl http://$(kubectl get service sample-app -o jsonpath='{ .spec.clusterIP }')/metrics
# 5. Create servicemonitor:
kubectl create -f service-monitor.yaml
# 6. Unsafe access but we only have it local so does not matter
kubectl create clusterrolebinding prometheus-admin --clusterrole cluster-admin --user system:anonymous
# 7. Chekc that prometheus sees metrics:
curl -k https://<metric-service> | grep "/metrics"
# 6. launch adapter
apt install build-essential
apt install golang
make docker-build
kubectl create namespace custom-metrics
./prometheus-adapter/deploy/manifests/gencerts.sh
./prometheus-adapter/deploy/manifests/deploy.sh
kubectl apply -f prometheus-adapter/deploy/manifests/
# TEST:


kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1
